<!DOCTYPE html>
<html>
  <head>
    <title>Storefront Docs</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.30.2" />

<title>Version Migration :: Storefront Docs</title>
<link rel="shortcut icon" href="/openstorefront/images/favicon.png" type="image/x-icon" />
<link href="/openstorefront/css/nucleus.css" rel="stylesheet">
<link href="/openstorefront/css/font-awesome.min.css" rel="stylesheet">
<link href="/openstorefront/css/hybrid.css" rel="stylesheet">
<link href="/openstorefront/css/featherlight.min.css" rel="stylesheet">
<link href="/openstorefront/css/auto-complete.css" rel="stylesheet">
<link href="/openstorefront/theme-original/style.css" rel="stylesheet">

  <link href="/openstorefront/theme-original/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="/openstorefront/css/bootstrap.min.css">
<script src="/openstorefront/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<meta name="description" content="">


    
  </head>
  <body data-url="/openstorefront/systemadmin/versionmigrationguide/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <h4 style="color:white;">Open Storefront Documentation</h4>

  

    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/openstorefront/js/lunr.min.js"></script>
		<script type="text/javascript" src="/openstorefront/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "\/openstorefront\/";
        
		</script>
		<script type="text/javascript" src="/openstorefront/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/openstorefront/" class="dd-item">
            <a href="/openstorefront/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/openstorefront/evaluations/" class="dd-item">
      <a href="/openstorefront/evaluations/">
        <span>Evaluations</span><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
    <li data-nav-id="/openstorefront/evaluations/evaluator/" class="dd-item">
      <a href="/openstorefront/evaluations/evaluator/">
        <span>Evaluator</span><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/openstorefront/evaluations/evaluator/storefront-evaluators-guide/" class="dd-item">
        <a href="/openstorefront/evaluations/evaluator/storefront-evaluators-guide/">
          <span>Evaluators Guide</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/evaluations/evaluator/faq/" class="dd-item">
        <a href="/openstorefront/evaluations/evaluator/faq/">
          <span>FAQ</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/openstorefront/evaluations/librarian/" class="dd-item">
      <a href="/openstorefront/evaluations/librarian/">
        <span>Librarian</span><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/openstorefront/evaluations/librarian/basic-entry-template-for-storefront/" class="dd-item">
        <a href="/openstorefront/evaluations/librarian/basic-entry-template-for-storefront/">
          <span>Basic Entry Template for Storefront</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/evaluations/librarian/createevaluationguide/" class="dd-item">
        <a href="/openstorefront/evaluations/librarian/createevaluationguide/">
          <span>Create an Evaluation</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/evaluations/librarian/publishinganevaluationguide/" class="dd-item">
        <a href="/openstorefront/evaluations/librarian/publishinganevaluationguide/">
          <span>Publish an Evaluation</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/openstorefront/dev/" class="dd-item">
      <a href="/openstorefront/dev/">
        <span>Developer</span><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/openstorefront/dev/developersguide/" class="dd-item">
        <a href="/openstorefront/dev/developersguide/">
          <span>Developer Guide</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/architecture/" class="dd-item">
        <a href="/openstorefront/dev/architecture/">
          <span>Architecture</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/front-end-code-standard/" class="dd-item">
        <a href="/openstorefront/dev/front-end-code-standard/">
          <span>Front-end Code Standards</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/gitworkflow/" class="dd-item">
        <a href="/openstorefront/dev/gitworkflow/">
          <span>Git Workflow</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/jira-workflow/" class="dd-item">
        <a href="/openstorefront/dev/jira-workflow/">
          <span>Jira Issue Tracking Workflow</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/testing/" class="dd-item">
        <a href="/openstorefront/dev/testing/">
          <span>Testing</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/uiguide/" class="dd-item">
        <a href="/openstorefront/dev/uiguide/">
          <span>User Interface Guide</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/dev/server-code-standard/" class="dd-item">
        <a href="/openstorefront/dev/server-code-standard/">
          <span>Server Code Standard</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/openstorefront/systemadmin/" class="dd-item parent">
      <a href="/openstorefront/systemadmin/">
        <span>System Admin</span>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/openstorefront/systemadmin/setup/" class="dd-item">
        <a href="/openstorefront/systemadmin/setup/">
          <span>Setup</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/systemadmin/docker/" class="dd-item">
        <a href="/openstorefront/systemadmin/docker/">
          <span>Using Docker</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/systemadmin/administratorguide/" class="dd-item">
        <a href="/openstorefront/systemadmin/administratorguide/">
          <span>Administrator Guide</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/systemadmin/datamigrationguide/" class="dd-item">
        <a href="/openstorefront/systemadmin/datamigrationguide/">
          <span>Data Migration Guide</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/systemadmin/versionmigrationguide/" class="dd-item active">
        <a href="/openstorefront/systemadmin/versionmigrationguide/">
          <span>Version Migration</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>
    <li data-nav-id="/openstorefront/user/" class="dd-item">
      <a href="/openstorefront/user/">
        <span>User</span><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </a>
        <ul>
      <li data-nav-id="/openstorefront/user/userguide/" class="dd-item">
        <a href="/openstorefront/user/userguide/">
          <span>User Guide</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
      <li data-nav-id="/openstorefront/user/quick-overview-of-submitting-a-new-component/" class="dd-item">
        <a href="/openstorefront/user/quick-overview-of-submitting-a-new-component/">
          <span>Submitting a New Component</span><i class="fa fa-circle-thin read-icon"></i>
        </a>
    </li>
        </ul>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/di2e/openstorefront/tree/master" target="_blank" rel="noopener"><i class='fa fa-github'></i> Github repo</a></li>
                <li class="" role=""><a href="https://github.com/di2e/openstorefront/releases" target="_blank" rel="noopener"><i class='fa fa-download'></i> Releases</a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer"><div style="color: #E0E0DA;">
    <p>OpenStoreFront version 2.5</p>
    <p>Documentation generated on Dec 21, 2017</p>
    <p>Created using <a href="https://gohugo.io/">Hugo</a> version 0.30.2</p>
</div>
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    
      
      
      
    <div id="top-github-link">
      <a class="github-link" href="https://github.com/di2e/openstorefront/edit/master/Hugo-StaticGen-Docs/content/systemadmin/VersionMigrationGuide.md" target="blank">
        <i class="fa fa-code-fork"></i>
        Edit page
      </a>
    </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='/openstorefront/'>OpenStoreFront Documentation</a> > <a href='/openstorefront/systemadmin/'>System Admin</a> > Version Migration

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Version Migration</h1>
  



    
    
    
    <p>In general, you should always upgrade one version at a time in order. (IE. going from 2.2 to 2.4 then 2.2 to 2.3 then to 2.4)  That way data migrations will occur in the proper order.  If you start from the lastest version and have no data then migration is not needed.</p>

<h2 id="note-243">Note: 2.4.3</h2>

<p>This includes the database upgrade.  Note: rollback to pervious storefront version will require restore from a backup proir to 2.4.3 for existing data to work for that version.</p>

<p><strong>2.4.2</strong> Must be deployed before 2.4.3 if you have existing data.</p>

<h2 id="note-242">Note: 2.4.2</h2>

<p>Includes a database export and import in preparation for 2.4.3 upgrade of DB.  If you have an existing database install 2.4.2 before 2.4.3.</p>

<ol>
<li>Shutdown app server</li>
<li>Backup /var/openstorefront/db directory</li>
<li>install/deploy 2.4.2</li>
<li>Start app server</li>
</ol>

<p>You need to wait for 5-20 minutes (Depending on size of DB) for the update to occur. At this time the application will be unavailable.</p>

<p>To manually export/import:</p>

<ol>
<li>install orient 2.1.25 to system to use console tool
a.) Shutdown app server</li>
</ol>

<p>From Orient</p>

<pre><code class="language-bash">$ cd bin
$ ./console.sh (or bin/console.bat under Windows)
orientdb&gt; CONNECT plocal:/var/openstorefront/db/openstorefront &lt;DBuser&gt; &lt;db password
orientdb&gt; EXPORT DATABASE /temp/mydb.json.gz
orientdb&gt; DISCONNECT
orientdb&gt; CREATE DATABASE plocal:/var/openstorefront/db/openstorefront only do this if you have move the old one out of the way)
orientdb&gt; IMPORT DATABASE /temp/mydb.json.gz
</code></pre>

<h2 id="upgrading-from-24-to-25">Upgrading from 2.4 to 2.5</h2>

<p>Pre-Deployment</p>

<p><strong>Elastic Search</strong></p>

<p>Change the value of <strong>elastic.server.port</strong> in /var/openstorefront/config/<strong>openstorefront.properties</strong> from <strong>9300</strong> to <strong>9200</strong></p>

<p>Windows (manually)</p>

<ol>
<li>Install and extract Elasticsearch 5.6.3 on the system</li>
<li>Remove/delete the root directory of Elasticsearch 2.x from the system</li>
<li>Start Elasticsearch 5.6.3 (by running the elasticsearch-5.6.3/elasticsearch-5.6.3/elasticsearch.bat file)</li>
</ol>

<p>CentOS using Yum</p>

<p><em>Documentation on installation: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html">https://www.elastic.co/guide/en/elasticsearch/reference/5.6/rpm.html</a></em></p>

<ol>
<li>Download and install the public signing key</li>
</ol>

<pre><code class="language-bash">$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</code></pre>

<ol start="2">
<li>Add the following in your /etc/yum.repos.d/ directory in a file with a .repo suffix, for example /etc/yum.repos.d/elasticsearch.repo</li>
</ol>

<pre><code class="language-ini">[elasticsearch-6.x]
name=Elasticsearch repository for 6.x packages
baseurl=https://artifacts.elastic.co/packages/6.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
</code></pre>

<ol start="3">
<li>Install Elasticsearch</li>
</ol>

<pre><code class="language-bash">$ sudo yum install elasticsearch
</code></pre>

<ol start="4">
<li>Run Elasticsearch (with <strong>SysV init</strong>)<br></li>
</ol>

<pre><code class="language-bash"># on system boot
$ sudo chkconfig --add elasticsearch

# manually
$ sudo -i service elasticsearch start
$ sudo -i service elasticsearch stop
</code></pre>

<ol start="5">
<li>Run Elasticsearch (with <strong>systemd</strong>)</li>
</ol>

<pre><code class="language-bash"># on system boot
$ sudo /bin/systemctl daemon-reload
$ sudo /bin/systemctl enable elasticsearch.service

#manually
$ sudo systemctl start elasticsearch.service
$ sudo systemctl stop elasticsearch.service
</code></pre>

<p>elasticsearch service command reference (elasticsearch should be running at this point):</p>

<p><strong>Start:</strong> systemctl start elasticsearch.service</p>

<p><strong>Stop:</strong>  systemctl stop elasticsearch.service</p>

<p><strong>Test:</strong> curl -XGET 'localhost:9200/?pretty'</p>

<p>should give you a response something like this:</p>

<pre><code>{
  &quot;name&quot; : &quot;Cp8oag6&quot;,
  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,
  &quot;cluster_uuid&quot; : &quot;AT69_T_DTp-1qgIJlatQqA&quot;,
  &quot;version&quot; : {
    &quot;number&quot; : &quot;5.4.3&quot;,
    &quot;build_hash&quot; : &quot;f27399d&quot;,
    &quot;build_date&quot; : &quot;2016-03-30T09:51:41.449Z&quot;,
    &quot;build_snapshot&quot; : false,
    &quot;lucene_version&quot; : &quot;6.5.0&quot;
  },
  &quot;tagline&quot; : &quot;You Know, for Search&quot;
}
</code></pre>

<p>Getting everything setup in the Open Storefront</p>

<ol>
<li>In Openstorefront, navigate to Admin Tools -&gt; Application Management -&gt; System -&gt; Search Control</li>
<li>Click &quot;Re-Index Listings&quot;</li>
<li>(optional) if you haven't set the elastic.server.port to 9200, you can do so now from <strong>Admin Tools</strong> -&gt; <strong>App Management</strong> -&gt; <strong>System</strong> -&gt; <strong>System Configuration Properties</strong></li>
</ol>

<h2 id="upgrading-from-23-to-24">Upgrading from 2.3 to 2.4</h2>

<div class="notices note" ><p>As part of the upgrade, Metadata will be automatically converted to Attributes.  This may take a while, if there is a lot of Metadata associated with the entries.  The server won't be avaliable until the migration is complete.</p>
</div>


<p>Pre-Deployment</p>

<ul>
<li>Edit /var/openstorefront/config/shiro.ini</li>
<li>under [url] section:
Confirm line &quot;/images&quot; is
<code>/images/* = anon</code></li>
<li>If not then update it.</li>
<li>Then restart server if it's running to apply changes.</li>
</ul>

<h2 id="upgrading-from-22-to-23">Upgrading from 2.2 to 2.3</h2>

<p>DI2E environments that use open am should follow JIRA ticket STORE-1243.</p>

<ol>
<li><p><strong>Update Security</strong>  - If you haven't done any customization then the easiest
upgrade path is to just remove the the existing shiro.ini.</p>

<ol type="a">
<li>Delete /var/openstorefront/config/shiro.ini</li>
<li>On next server restart the application will pull the default
<br></li>
</ol>

<p>Keep in mind this is for environments that use the built in user management rather then an external user management.
The default shiro config is set for the built in user management.</p></li>

<li><p><strong>Update Database</strong> - 2.3 includes a update to the database.</p>

<ol type="a">
<li>Make sure tomcat is shutdown</li>
<li>Make a backup of existing db

<ol>
<li>Copy /var/openstorefront/db directory to backup location</li>
</ol></li>
<li>Delete all /var/openstorefront/db/databases/openstorefront/openstorefront.*.wal files (just the WAL files there maybe 1 or more) (This appears to be optional)</li>
</ol></li>
</ol>


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/openstorefront/systemadmin/datamigrationguide/" title="Data Migration Guide"> <i class="fa fa-chevron-left"></i></a>
    <a class="nav nav-next" href="/openstorefront/user/" title="User" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/openstorefront/js/clipboard.min.js"></script>
<script src="/openstorefront/js/featherlight.min.js"></script>
<script src="/openstorefront/js/html5shiv-printshiv.min.js"></script>
<script src="/openstorefront/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/openstorefront/js/modernizr.custom.71422.js"></script>
<script src="/openstorefront/js/docdock.js"></script>
<script src="/openstorefront/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>